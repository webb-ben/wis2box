
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Extending wis2box &#8212; wis2box 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="https://public.wmo.int/sites/all/themes/wmo/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Development" href="development.html" />
    <link rel="prev" title="Using Python and paho-mqtt" href="data-access/python-mqp-subscribe.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="development.html" title="Development"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="data-access/python-mqp-subscribe.html" title="Using Python and paho-mqtt"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">wis2box 0.0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Extending wis2box</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="extending-wis2box">
<span id="id1"></span><h1>Extending wis2box<a class="headerlink" href="#extending-wis2box" title="Permalink to this headline">¶</a></h1>
<p>At its core, wis2box is a plugin architecture orchestrating all the required components of a node in
the WIS 2.0 network. Driven by topic hierarchies, wis2box can be used to process and publish any type
of geospatial data beyond the requirements of the WIS 2.0 itself.</p>
<p>In this section we will to explore how wis2box can be extended. wis2box plugin development requires
knowledge of how to program in Python as well as Python’s packaging and module system.</p>
<section id="building-your-own-data-plugin">
<h2>Building your own data plugin<a class="headerlink" href="#building-your-own-data-plugin" title="Permalink to this headline">¶</a></h2>
<p>The heart of a wis2box data plugin is driven from the <code class="docutils literal notranslate"><span class="pre">wis2box.data.base</span></code> abstract base class (ABC)
located in <code class="docutils literal notranslate"><span class="pre">wis2box/data/base.py</span></code>. Any wis2box plugin needs to inherit from
<code class="docutils literal notranslate"><span class="pre">wis2box.data.base.BaseAbstractData</span></code>. A minimal example can be found below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">wis2box.data.base</span> <span class="kn">import</span> <span class="n">BaseAbstractData</span>

<span class="k">class</span> <span class="nc">MyCoolData</span><span class="p">(</span><span class="n">BaseAbstractData</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Observation data&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_hierarchy</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">topic_hierarchy</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># transform data</span>
        <span class="c1"># populate self.output_data with a dict as per:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_data</span> <span class="p">[{</span>
            <span class="s1">&#39;_meta&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;identifier&#39;</span><span class="p">:</span> <span class="s1">&#39;c123&#39;</span>
                <span class="s1">&#39;data_date&#39;</span><span class="p">:</span> <span class="n">datetime_object</span>
            <span class="p">},</span>
            <span class="s1">&#39;bufr4&#39;</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">12356</span><span class="p">),</span>
            <span class="s1">&#39;geojson&#39;</span><span class="p">:</span> <span class="n">geojson_string</span>
        <span class="p">}]</span>
        <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<p>The key function that plugin needs to implement is the <code class="docutils literal notranslate"><span class="pre">transform</span></code> function. This function
should return a <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> of the result of the processing, as well as populate
the <code class="docutils literal notranslate"><span class="pre">output_data</span></code> property.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">output_data</span></code> property should provide a <code class="docutils literal notranslate"><span class="pre">list</span></code> of objects with the following properties:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_meta</span></code>: object with identifier and Python <a class="reference external" href="https://docs.python.org/3/library/datetime.html">datetime</a> objects based on the observed datetime of the data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;format-extension&gt;</span></code>: 1..n properties for each format representation, with the key being the filename
extension. The value of this property can be a string or bytes, depending on whether the underlying data
is ASCII or binary, for example</p></li>
</ul>
</section>
<section id="packaging">
<h2>Packaging<a class="headerlink" href="#packaging" title="Permalink to this headline">¶</a></h2>
<p>The next step is assembling your plugin using standard Python packaging. All plugin code and configuration files
should be made part of the package so that it can operate independently when running in wis2box.  For distribution and
installation, you have the following options:</p>
<ul class="simple">
<li><p>publish to the <a class="reference external" href="https://pypi.org">Python Package Index (PyPI)</a> and install in the wis2node container with <code class="docutils literal notranslate"><span class="pre">pip3</span> <span class="pre">install</span> <span class="pre">wis2box-mypackage</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span></code> or download your package, and install via <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">setup.py</span> <span class="pre">install</span></code></p></li>
</ul>
<p>See the <a class="reference external" href="https://packaging.python.org/en/latest/tutorials/packaging-projects">Python packaging tutorial</a> or <a class="reference external" href="https://github.com/audreyfeldroy/cookiecutter-pypackage">Cookiecutter PyPackage</a> for guidance and templates/examples.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is recommended to name your wis2box packages with the convention <code class="docutils literal notranslate"><span class="pre">wis2box-MYPLUGIN-NAME</span></code>, as well as
adding the keywords/topics <code class="docutils literal notranslate"><span class="pre">wis2box</span></code> and <code class="docutils literal notranslate"><span class="pre">plugin</span></code> to help discovery on platforms such as GitHub.</p>
</div>
</section>
<section id="integration">
<h2>Integration<a class="headerlink" href="#integration" title="Permalink to this headline">¶</a></h2>
<p>Once your package is installed on the wis2box container, the data mappings need to be updated to connect
your plugin to a topic hierarchy.  See <a class="reference internal" href="running/data-mappings.html#data-mappings"><span class="std std-ref">Data mappings</span></a> for more information.</p>
<p>An example plugin for proof of concept can be found in <a class="reference external" href="https://github.com/wmo-cop/wis2box-malawi-observations">https://github.com/wmo-cop/wis2box-malawi-observations</a></p>
</section>
<section id="example-plugins">
<h2>Example plugins<a class="headerlink" href="#example-plugins" title="Permalink to this headline">¶</a></h2>
<p>The following plugins provide useful examples of wis2box plugins implemented
by downstream applications.</p>
<table class="docutils align-left">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Plugin(s)</p></th>
<th class="head"><p>Organization/Project</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://github.com/wmo-cop/wis2box-malawi-observations">wis2box-malawi-observations</a></p></td>
<td><p>WMO</p></td>
<td><p>plugin for Malawi surface observation data</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://github.com/opencdms/wis2box-pyopencdms-plugin">wis2box-pyopencdms-plugin</a></p></td>
<td><p>OpenCDMS</p></td>
<td><p>plugin for connecting the Open Climate Data Management System to wis2box</p></td>
</tr>
</tbody>
</table>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="data-access/python-mqp-subscribe.html"
                          title="previous chapter">Using Python and paho-mqtt</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="development.html"
                          title="next chapter">Development</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><p>
    <p>
        <a title="World Meteorological Organization" href="https://public.wmo.int"><img style="background: white;" title="WMO logo" alt="WMO logo" src="https://public.wmo.int/sites/all/themes/wmo/logo.png"/></a>
    </p>
</p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="development.html" title="Development"
             >next</a> |</li>
        <li class="right" >
          <a href="data-access/python-mqp-subscribe.html" title="Using Python and paho-mqtt"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">wis2box 0.0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Extending wis2box</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021-2022, World Meteorological Organization (WMO)&lt;br/&gt;This work is licensed under a Creative Commons Attribution 4.0 International License.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>